# Video Translation Status Client and Server

This project implements a simple server-client system to monitor the status of a video translation job. The server simulates a video translation backend, responding with different statuses (`pending`, `completed`, `error`). The client library checks this status and provides a user-friendly interface to monitor job completion with minimal delays and optimized polling intervals.

# Table of Contents

- [Overview](#overview)
- [Server Setup and Usage](#server-setup-and-usage)
- [Client Library Usage](#client-library-usage)
- [Integration Test](#integration-test)

---


## Overview

### Server

The server exposes an HTTP endpoint to return the status of a video translation job. The job status can be one of the following:

- `pending`
- `completed`
- `error`

The server simulates a video translation backend and will return "pending" until a configurable delay has passed. Once the processing time elapses, the status is updated to either "completed" if successful or "error" if an issue occurred.

The server API endpoint is designed to handle requests for the status of a specific video job. When a client sends a GET request to `/status/{videoId}`, the server responds with a JSON object containing the `result` field. The format of the response is as follows:

```json
{
  "videoId": "video12345",
  "result": "pending"
}
```

### Client Library

The client library is designed for third-party integration, allowing users to query the server's status endpoint for specific video jobs. The client optimizes polling intervals to reduce delays and server load. It retries failed requests and minimizes unnecessary requests to the server, balancing response time and efficiency.

The client library takes a list of video IDs from an input file and polls the server for each video's status until it receives a "completed" or "error" response, or until a timeout occurs. The client checks for status updates at an initial interval defined in the configuration. With each subsequent poll, the interval doubles until it reaches the maximum configured interval. This polling strategy minimizes the frequency of requests over time, reducing server load while ensuring timely updates for each video.

Once the client receives a final status ("completed" or "error"), it writes the video ID and its status to an output file, providing a log of results for all processed videos. In case of repeated failures, the client stops polling after reaching a maximum retry limit and logs the outcome.

All logs generated by the client are stored in the file `client/logs/status_client.log`.

#### Input and Output

The input and output files are present in the resources folder of the client module.

1. **Input File (`video_ids.txt`)**: This file contains a list of video IDs, each on a new line, which the client will process.

2. **Output File (`video_status.txt`)**: This file logs the final status of each video ID, listing whether each translation job is "completed" or "error".

### Integration Test

The integration test verifies that the client correctly interacts with the server by:

- Starting the server in a test environment.
- Using the client to query statuses based on provided video IDs.
- Validating that the client handles each status update correctly, including polling behavior and logging final statuses in the output file.

The test confirms that the client and server operate as expected, demonstrating the robustness of the polling mechanism and the efficiency of client-server interaction.

## Server Setup and Usage

### Requirements
- Java 21
- Maven 3.8
- Spring Boot 3.1.0

### Running the Server
1. Navigate to the `server` module.
2. Run the following command to start the server:
    ```bash
    cd server/
    mvn spring-boot:run
    ```
3. The server will be running on `http://localhost:8080`.

### Endpoint

- **GET** `/status/{videoId}`: Returns the job status for the specified `videoId`.

  **Sample response:**
    ```json
    {
      "videoId": "video12348",
      "result": "pending" 
    }
    ```


## Client Library Usage

### Requirements
- **Java 21**
- **Maven 3.8 or higher**

### Configuration
The client configuration can be customized in the `config.properties` file. This file contains parameters that control the behavior of the client library, including polling intervals, timeout durations, retry limits, input output file paths server url and more.

### Running the Client Library
Navigate to the `client` module and run the client with the following commands:

```bash
    cd client/
    mvn clean install
    java -jar target/client-1.0-SNAPSHOT.jar
```

### Client Working

- **Polling Logic**: The client polls the server at intervals to check the job status for each video ID in the `input.file.path`. If the job is pending, the client waits for the configured initial interval (`polling.interval.initial.milliseconds`) before polling again. The interval increases on each poll until reaching the maximum interval (`polling.interval.max.milliseconds`), which helps reduce load on the server.

- **Retries**: If the server fails to respond or other issues occur, the client retries up to the configured maximum (`retries.max`) before giving up on that request.

- **Output**: Once the client receives a "completed" or "error" status, it writes the result for each video ID to the specified output file (`output.file.path`).



## Integration Test

### Purpose
The integration test verifies that the client and server interact correctly. It checks that the client correctly interprets server responses and handles polling, retries, and result output as expected.

### Running the Integration Test

1. Navigate to the `integrationTest` module.
2. Run the following command:

    ```bash
    cd integrationTest/
    mvn test
    ```

3. This test will:
    - Start the server on a random port.
    - Use the `StatusClient` to read video IDs from an input file and request their statuses from the server.
    - Verify that an output file is created with the expected statuses for each video ID (e.g., "completed" or "error").
    - Clean up by deleting the test input and output files after execution.

